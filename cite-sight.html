<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CiteSight - Academic Document Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            margin-bottom: 30px;
        }

        .upload-section {
            border: 3px dashed #e0e0e0;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fafafa;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: #f5f3ff;
        }

        .upload-section.dragover {
            border-color: #667eea;
            background: #f5f3ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .upload-text {
            color: #666;
            margin-bottom: 10px;
        }

        .supported-formats {
            color: #999;
            font-size: 0.9rem;
        }

        .options-section {
            margin-top: 30px;
            display: none;
        }

        .option-group {
            margin-bottom: 20px;
        }

        .option-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .option-group select,
        .option-group input[type="checkbox"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .option-group select {
            width: 100%;
            max-width: 300px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }

        .process-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 20px;
        }

        .process-button:hover {
            transform: translateY(-2px);
        }

        .process-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .file-list {
            margin-top: 20px;
        }

        .file-item {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-name {
            font-weight: 500;
            color: #333;
        }

        .file-size {
            color: #666;
            font-size: 0.9rem;
        }

        .remove-file {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .progress-section {
            display: none;
            margin-top: 30px;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .progress-status {
            text-align: center;
            color: #666;
        }

        .results-section {
            display: none;
            margin-top: 30px;
        }

        .results-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
        }

        .results-body {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 0 0 8px 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tabs-container {
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tabs-header {
            display: flex;
            background: #f0f0f0;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-button {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button:hover {
            background: #e8e8e8;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab-button .badge {
            display: inline-block;
            background: #ff4444;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 0.75rem;
            margin-left: 5px;
        }

        .tab-content {
            padding: 30px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analysis-card {
            background: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .analysis-card h4 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .analysis-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }

        .analysis-label {
            color: #666;
            font-size: 0.9rem;
        }

        .readability-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
        }

        .readability-easy {
            background: #d4edda;
            color: #155724;
        }

        .readability-medium {
            background: #fff3cd;
            color: #856404;
        }

        .readability-hard {
            background: #f8d7da;
            color: #721c24;
        }

        .word-cloud {
            min-height: 300px;
            background: #f8f8f8;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .word-cloud-item {
            display: inline-block;
            padding: 5px 10px;
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: default;
        }

        .word-cloud-item:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, #667eea40 0%, #764ba240 100%);
        }

        .suspicious-patterns {
            background: #fff5f5;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .pattern-category {
            margin-bottom: 25px;
        }

        .pattern-category h4 {
            color: #d32f2f;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pattern-item {
            background: white;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #ff4444;
            border-radius: 4px;
        }

        .pattern-severity {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .severity-high {
            background: #ffebee;
            color: #c62828;
        }

        .severity-medium {
            background: #fff3e0;
            color: #e65100;
        }

        .severity-low {
            background: #fff9c4;
            color: #f57f17;
        }

        .writing-quality-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quality-metric {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .quality-metric h5 {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 0.9rem;
        }

        .quality-score {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 5px 0;
        }

        .quality-good {
            color: #4caf50;
        }

        .quality-warning {
            color: #ff9800;
        }

        .quality-poor {
            color: #f44336;
        }

        .quality-hint {
            font-size: 0.85rem;
            color: #999;
            margin-top: 5px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-card h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.1rem;
        }

        .comparison-metrics {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .metric-label {
            color: #666;
            font-size: 0.9rem;
        }

        .metric-value {
            font-weight: 600;
            color: #333;
        }

        .similarity-warning {
            background: #fff3e0;
            border: 1px solid #ffcc80;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
        }

        .similarity-warning h4 {
            color: #e65100;
            margin: 0 0 10px 0;
        }

        .processing-mode {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
        }

        .mode-option {
            flex: 1;
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-option:hover {
            border-color: #667eea;
        }

        .mode-option.selected {
            border-color: #667eea;
            background: #f5f3ff;
        }

        .mode-option h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .mode-option p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }

        .privacy-notice {
            background: #e8f5e9;
            border: 1px solid #a5d6a7;
            border-radius: 6px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #2e7d32;
        }

        .privacy-notice strong {
            display: block;
            margin-bottom: 5px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .issues-list {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .issue-item {
            padding: 15px;
            border-left: 4px solid #ff4444;
            background: #fff5f5;
            margin-bottom: 15px;
            border-radius: 4px;
        }

        .issue-item.warning {
            border-left-color: #ffaa00;
            background: #fffaf0;
        }

        .issue-type {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .issue-details {
            color: #666;
            line-height: 1.6;
        }

        .export-buttons {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .export-button {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .export-button:hover {
            background: #667eea;
            color: white;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>👁️ CiteSight</h1>
            <p>See Your Citations Clearly - Verify References, Analyze Writing, Ensure Integrity</p>
        </div>

        <div class="main-card">
            <div class="upload-section" id="uploadSection">
                <div class="upload-icon">📄</div>
                <div class="upload-text">Drop files here or click to upload</div>
                <div class="supported-formats">Supports: PDF, Word (.docx), PowerPoint (.pptx), Text (.txt, .md), JSON</div>
                <input type="file" id="fileInput" class="file-input" multiple accept=".pdf,.docx,.pptx,.txt,.md,.json">
            </div>

            <div class="file-list" id="fileList"></div>

            <div class="options-section" id="optionsSection">
                <div class="processing-mode">
                    <div class="mode-option selected" onclick="selectMode('server')" id="serverMode">
                        <h4>🌐 Server Processing</h4>
                        <p>Fast, full features, immediate deletion after processing</p>
                    </div>
                    <div class="mode-option" onclick="selectMode('local')" id="localMode">
                        <h4>🔒 Local Processing</h4>
                        <p>Privacy-first, processed in your browser, no upload</p>
                    </div>
                </div>
                
                <div class="privacy-notice">
                    <strong>🔒 Privacy Guarantee:</strong>
                    Server mode: Files are processed in memory only and immediately deleted. No data is stored.
                    Local mode: Files never leave your computer.
                </div>

                <div class="option-group">
                    <label for="citationStyle">Citation Style:</label>
                    <select id="citationStyle">
                        <option value="auto">Auto-detect</option>
                        <option value="apa">APA</option>
                        <option value="chicago">Chicago</option>
                        <option value="mla">MLA</option>
                        <option value="ieee">IEEE</option>
                    </select>
                </div>

                <div class="option-group">
                    <label>Verification Options:</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="checkUrls" checked>
                        <label for="checkUrls">Check URL accessibility</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="checkContent">
                        <label for="checkContent">Verify URL content matches citation</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="checkWayback" checked>
                        <label for="checkWayback">Check Wayback Machine for broken links</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="checkDoi" checked>
                        <label for="checkDoi">Resolve and verify DOIs</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="checkInText" checked>
                        <label for="checkInText">Verify in-text citations match references</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="checkPlagiarism" checked>
                        <label for="checkPlagiarism">Check for self-plagiarism (requires history)</label>
                    </div>
                </div>

                <button class="process-button" id="processButton">
                    Process Documents
                </button>
            </div>

            <div class="progress-section" id="progressSection">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div class="progress-status" id="progressStatus">Initializing...</div>
            </div>

            <div class="results-section" id="resultsSection">
                <div class="results-header">
                    <h2>Document Analysis & Verification Results</h2>
                </div>
                <div class="results-body">
                    <div class="tabs-container">
                        <div class="tabs-header">
                            <button class="tab-button active" onclick="switchTab('references')">📚 References</button>
                            <button class="tab-button" onclick="switchTab('suspicious')">
                                ⚠️ Suspicious Patterns
                                <span class="badge" id="suspiciousBadge" style="display: none;">0</span>
                            </button>
                            <button class="tab-button" onclick="switchTab('analysis')">📊 Document Analysis</button>
                            <button class="tab-button" onclick="switchTab('quality')">✍️ Writing Quality</button>
                            <button class="tab-button" onclick="switchTab('wordcloud')">☁️ Word Analysis</button>
                            <button class="tab-button" onclick="switchTab('phrases')">💬 Unique Phrases</button>
                            <button class="tab-button" id="comparisonTab" style="display: none;" onclick="switchTab('comparison')">
                                📋 Comparison
                            </button>
                        </div>
                        
                        <div id="references-tab" class="tab-content active">
                            <div class="stats-grid" id="statsGrid"></div>
                            <div class="issues-list" id="issuesList"></div>
                        </div>
                        
                        <div id="suspicious-tab" class="tab-content">
                            <div class="suspicious-patterns" id="suspiciousPatterns"></div>
                        </div>
                        
                        <div id="analysis-tab" class="tab-content">
                            <div class="analysis-grid" id="analysisGrid"></div>
                        </div>
                        
                        <div id="quality-tab" class="tab-content">
                            <h3>Writing Quality Metrics</h3>
                            <div class="writing-quality-grid" id="qualityGrid"></div>
                        </div>
                        
                        <div id="wordcloud-tab" class="tab-content">
                            <h3>Most Frequent Words</h3>
                            <div class="word-cloud" id="wordCloud"></div>
                            <h3 style="margin-top: 30px;">Rare/Unique Words (appears only 1-2 times)</h3>
                            <div class="word-cloud" id="uniqueWords"></div>
                        </div>
                        
                        <div id="phrases-tab" class="tab-content">
                            <h3>Distinctive Phrases (2-4 words)</h3>
                            <div class="unique-phrases" id="uniquePhrases"></div>
                        </div>
                        
                        <div id="comparison-tab" class="tab-content">
                            <h3>Document Comparison</h3>
                            <div class="comparison-grid" id="comparisonGrid"></div>
                            <div class="similarity-warning" id="similarityWarning" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <div class="export-buttons">
                        <button class="export-button" onclick="exportMarkdown()">Export as Markdown</button>
                        <button class="export-button" onclick="exportText()">Export as Text</button>
                        <button class="export-button" onclick="exportPDF()">Export as PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedFiles = [];
        let currentResults = null;
        let processingMode = 'server';
        let documentFingerprints = {}; // For self-plagiarism detection

        // File upload handling
        const uploadSection = document.getElementById('uploadSection');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const optionsSection = document.getElementById('optionsSection');
        const processButton = document.getElementById('processButton');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressStatus = document.getElementById('progressStatus');
        const resultsSection = document.getElementById('resultsSection');

        uploadSection.addEventListener('click', () => fileInput.click());

        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            for (let file of files) {
                if (isValidFile(file)) {
                    uploadedFiles.push(file);
                }
            }
            updateFileList();
            if (uploadedFiles.length > 0) {
                optionsSection.style.display = 'block';
                // Show comparison tab if multiple files
                if (uploadedFiles.length > 1) {
                    document.getElementById('comparisonTab').style.display = 'block';
                }
            }
        }

        function isValidFile(file) {
            const validExtensions = ['.pdf', '.docx', '.pptx', '.txt', '.md', '.json'];
            const fileName = file.name.toLowerCase();
            return validExtensions.some(ext => fileName.endsWith(ext));
        }

        function updateFileList() {
            fileList.innerHTML = '';
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div>
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">Remove</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            if (uploadedFiles.length === 0) {
                optionsSection.style.display = 'none';
            }
            if (uploadedFiles.length <= 1) {
                document.getElementById('comparisonTab').style.display = 'none';
            }
        }

        function selectMode(mode) {
            processingMode = mode;
            document.querySelectorAll('.mode-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById(mode + 'Mode').classList.add('selected');
        }

        // Process documents
        processButton.addEventListener('click', async () => {
            if (uploadedFiles.length === 0) return;

            progressSection.style.display = 'block';
            resultsSection.style.display = 'none';
            processButton.disabled = true;

            // Simulate processing for demo
            await simulateProcessing();

            processButton.disabled = false;
        });

        async function simulateProcessing() {
            const steps = [
                { progress: 10, status: 'Extracting text from documents...' },
                { progress: 15, status: 'Checking for self-plagiarism...' },
                { progress: 20, status: 'Analyzing document readability...' },
                { progress: 25, status: 'Detecting suspicious patterns...' },
                { progress: 30, status: 'Identifying references...' },
                { progress: 40, status: 'Extracting URLs and DOIs...' },
                { progress: 50, status: 'Analyzing writing quality...' },
                { progress: 60, status: 'Checking URL accessibility...' },
                { progress: 70, status: 'Verifying DOIs...' },
                { progress: 80, status: 'Matching in-text citations...' },
                { progress: 90, status: 'Extracting unique phrases...' },
                { progress: 100, status: 'Generating report...' }
            ];

            for (let step of steps) {
                progressFill.style.width = step.progress + '%';
                progressFill.textContent = step.progress + '%';
                progressStatus.textContent = step.status;
                await new Promise(resolve => setTimeout(resolve, 400));
            }

            // Show mock results
            showResults();
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        function calculateFleschScore(sentences, words, syllables) {
            // Flesch Reading Ease formula
            return 206.835 - 1.015 * (words / sentences) - 84.6 * (syllables / words);
        }

        function getReadabilityLevel(score) {
            if (score >= 60) return { level: 'Easy', class: 'readability-easy', description: 'Undergraduate level' };
            if (score >= 30) return { level: 'Medium', class: 'readability-medium', description: 'Graduate level' };
            return { level: 'Difficult', class: 'readability-hard', description: 'Professional/Academic' };
        }

        function detectPassiveVoice(text) {
            const passiveIndicators = [
                /\b(was|were|been|being|is|are|am)\s+\w+ed\b/gi,
                /\b(was|were|been|being|is|are|am)\s+being\s+\w+ed\b/gi,
                /\b(will|shall)\s+be\s+\w+ed\b/gi
            ];
            
            let matches = 0;
            passiveIndicators.forEach(pattern => {
                const found = text.match(pattern);
                if (found) matches += found.length;
            });
            
            const sentences = text.split(/[.!?]+/).length;
            return (matches / sentences * 100).toFixed(1);
        }

        function showResults() {
            progressSection.style.display = 'none';
            resultsSection.style.display = 'block';

            // Mock results data with all new features
            currentResults = {
                // Reference verification
                totalReferences: 45,
                brokenUrls: 3,
                unresolvedDois: 2,
                missingInText: 4,
                orphanedInText: 1,
                
                // Suspicious patterns
                suspiciousPatterns: {
                    selfPlagiarism: [
                        { text: 'This paragraph matches 87% with submission from 2023-09-15', severity: 'high' },
                        { text: 'Introduction section has 65% similarity with previous paper', severity: 'medium' }
                    ],
                    citationAnomalies: [
                        { text: 'Reference #31: Published date (2026) is after submission date', severity: 'high' },
                        { text: '8 citations in paragraph 3 - possible citation stuffing', severity: 'medium' },
                        { text: '12 references never cited in text - bibliography padding suspected', severity: 'low' }
                    ],
                    styleInconsistencies: [
                        { text: 'Citation style changes from APA to MLA at page 8', severity: 'medium' },
                        { text: 'Writing complexity drops significantly in section 4', severity: 'low' }
                    ]
                },
                
                // Document analysis
                wordCount: 8547,
                sentenceCount: 342,
                avgWordsPerSentence: 25,
                paragraphCount: 87,
                fleschScore: 42.3,
                fleschKincaidGrade: 14.2,
                
                // Writing quality
                passiveVoicePercentage: 32.5,
                sentenceVariety: 68,
                transitionWords: 12.3,
                hedgingLanguage: 8.7,
                academicTone: 85,
                
                // Word analysis
                mostFrequentWords: [
                    { word: 'analysis', count: 89, size: 32 },
                    { word: 'methodology', count: 76, size: 30 },
                    { word: 'research', count: 72, size: 29 },
                    { word: 'significant', count: 64, size: 28 },
                    { word: 'hypothesis', count: 58, size: 26 },
                    { word: 'correlation', count: 52, size: 24 },
                    { word: 'framework', count: 48, size: 23 },
                    { word: 'empirical', count: 45, size: 22 },
                    { word: 'quantitative', count: 41, size: 21 },
                    { word: 'variables', count: 38, size: 20 },
                    { word: 'theoretical', count: 35, size: 19 },
                    { word: 'implementation', count: 32, size: 18 }
                ],
                
                uniqueWords: [
                    'paradigmatic', 'heteroscedasticity', 'epistemological', 'phenomenological',
                    'hermeneutic', 'axiological', 'ontological', 'triangulation',
                    'verisimilitude', 'praxis', 'dialectical', 'heuristic'
                ],
                
                uniquePhrases: [
                    { phrase: 'statistically significant correlation', count: 8 },
                    { phrase: 'theoretical framework suggests', count: 6 },
                    { phrase: 'empirical evidence indicates', count: 5 },
                    { phrase: 'methodological rigor ensures', count: 4 },
                    { phrase: 'null hypothesis rejected', count: 4 },
                    { phrase: 'convergent validity established', count: 3 },
                    { phrase: 'phenomenological inquiry reveals', count: 2 },
                    { phrase: 'epistemological stance adopted', count: 2 }
                ],
                
                // Comparison data (if multiple files)
                comparison: uploadedFiles.length > 1 ? [
                    {
                        name: uploadedFiles[0].name,
                        wordCount: 8547,
                        readability: 42.3,
                        references: 45,
                        issues: 10
                    },
                    {
                        name: uploadedFiles[1]?.name || 'Document 2',
                        wordCount: 7823,
                        readability: 38.7,
                        references: 38,
                        issues: 7
                    }
                ] : null,
                
                issues: [
                    {
                        type: 'error',
                        title: 'Broken URL',
                        details: 'Reference #12: Smith, J. (2023). URL https://example.com/paper returns 404. Wayback Machine has a snapshot from 2023-01-15.'
                    },
                    {
                        type: 'error',
                        title: 'Unresolved DOI',
                        details: 'Reference #18: DOI 10.1234/invalid-doi could not be resolved.'
                    },
                    {
                        type: 'warning',
                        title: 'Missing in-text citation',
                        details: 'Reference #23: Johnson, K. (2022) appears in references but has no corresponding in-text citation.'
                    },
                    {
                        type: 'warning',
                        title: 'Orphaned in-text citation',
                        details: 'In-text citation (Williams, 2021) on page 7 has no corresponding reference entry.'
                    },
                    {
                        type: 'warning',
                        title: 'Inconsistent citation style',
                        details: 'Mixed use of "et al." and "and colleagues" detected. Reference #8 uses different format.'
                    }
                ]
            };

            // Display reference stats
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${currentResults.totalReferences}</div>
                    <div class="stat-label">Total References</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #ff4444">${currentResults.brokenUrls}</div>
                    <div class="stat-label">Broken URLs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #ff4444">${currentResults.unresolvedDois}</div>
                    <div class="stat-label">Unresolved DOIs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #ffaa00">${currentResults.missingInText}</div>
                    <div class="stat-label">Missing In-Text</div>
                </div>
            `;

            // Display issues
            const issuesList = document.getElementById('issuesList');
            issuesList.innerHTML = '<h3>Reference Issues Found:</h3>';
            currentResults.issues.forEach(issue => {
                const issueItem = document.createElement('div');
                issueItem.className = `issue-item ${issue.type === 'warning' ? 'warning' : ''}`;
                issueItem.innerHTML = `
                    <div class="issue-type">${issue.title}</div>
                    <div class="issue-details">${issue.details}</div>
                `;
                issuesList.appendChild(issueItem);
            });

            // Display suspicious patterns
            displaySuspiciousPatterns();

            // Display document analysis
            const readability = getReadabilityLevel(currentResults.fleschScore);
            const analysisGrid = document.getElementById('analysisGrid');
            analysisGrid.innerHTML = `
                <div class="analysis-card">
                    <h4>Word Count</h4>
                    <div class="analysis-value">${currentResults.wordCount.toLocaleString()}</div>
                    <div class="analysis-label">Total words in document</div>
                </div>
                <div class="analysis-card">
                    <h4>Sentence Count</h4>
                    <div class="analysis-value">${currentResults.sentenceCount}</div>
                    <div class="analysis-label">Avg ${currentResults.avgWordsPerSentence} words/sentence</div>
                </div>
                <div class="analysis-card">
                    <h4>Flesch Reading Ease</h4>
                    <div class="analysis-value">${currentResults.fleschScore.toFixed(1)}</div>
                    <div class="readability-indicator ${readability.class}">${readability.level}: ${readability.description}</div>
                </div>
                <div class="analysis-card">
                    <h4>Flesch-Kincaid Grade</h4>
                    <div class="analysis-value">${currentResults.fleschKincaidGrade.toFixed(1)}</div>
                    <div class="analysis-label">Years of education needed</div>
                </div>
                <div class="analysis-card">
                    <h4>Paragraph Count</h4>
                    <div class="analysis-value">${currentResults.paragraphCount}</div>
                    <div class="analysis-label">Document structure</div>
                </div>
                <div class="analysis-card">
                    <h4>Unique Vocabulary</h4>
                    <div class="analysis-value">2,341</div>
                    <div class="analysis-label">Distinct words used</div>
                </div>
            `;

            // Display writing quality
            displayWritingQuality();

            // Display word cloud
            const wordCloud = document.getElementById('wordCloud');
            wordCloud.innerHTML = '';
            currentResults.mostFrequentWords.forEach(item => {
                const wordItem = document.createElement('span');
                wordItem.className = 'word-cloud-item';
                wordItem.style.fontSize = `${item.size}px`;
                wordItem.style.opacity = 0.6 + (item.size / 32) * 0.4;
                wordItem.innerHTML = `${item.word} <small>(${item.count})</small>`;
                wordCloud.appendChild(wordItem);
            });

            // Display unique/rare words
            const uniqueWords = document.getElementById('uniqueWords');
            uniqueWords.innerHTML = '';
            currentResults.uniqueWords.forEach(word => {
                const wordItem = document.createElement('span');
                wordItem.className = 'word-cloud-item';
                wordItem.style.fontSize = '14px';
                wordItem.style.background = 'linear-gradient(135deg, #ff6b6b20 0%, #feca5720 100%)';
                wordItem.innerHTML = word;
                uniqueWords.appendChild(wordItem);
            });

            // Display unique phrases
            const uniquePhrases = document.getElementById('uniquePhrases');
            uniquePhrases.innerHTML = '';
            currentResults.uniquePhrases.forEach(item => {
                const phraseItem = document.createElement('div');
                phraseItem.className = 'phrase-item';
                phraseItem.innerHTML = `
                    <span class="phrase-text">"${item.phrase}"</span>
                    <span class="phrase-count">${item.count}x</span>
                `;
                uniquePhrases.appendChild(phraseItem);
            });

            // Display comparison if multiple files
            if (currentResults.comparison) {
                displayComparison();
            }
        }

        function displaySuspiciousPatterns() {
            const container = document.getElementById('suspiciousPatterns');
            const patterns = currentResults.suspiciousPatterns;
            let totalIssues = 0;
            
            let html = '';
            
            // Self-plagiarism
            if (patterns.selfPlagiarism.length > 0) {
                html += '<div class="pattern-category"><h4>🔄 Self-Plagiarism Detected</h4>';
                patterns.selfPlagiarism.forEach(item => {
                    totalIssues++;
                    html += `<div class="pattern-item">
                        ${item.text}
                        <span class="pattern-severity severity-${item.severity}">${item.severity.toUpperCase()}</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            // Citation anomalies
            if (patterns.citationAnomalies.length > 0) {
                html += '<div class="pattern-category"><h4>📚 Citation Anomalies</h4>';
                patterns.citationAnomalies.forEach(item => {
                    totalIssues++;
                    html += `<div class="pattern-item">
                        ${item.text}
                        <span class="pattern-severity severity-${item.severity}">${item.severity.toUpperCase()}</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            // Style inconsistencies
            if (patterns.styleInconsistencies.length > 0) {
                html += '<div class="pattern-category"><h4>✍️ Style Inconsistencies</h4>';
                patterns.styleInconsistencies.forEach(item => {
                    totalIssues++;
                    html += `<div class="pattern-item">
                        ${item.text}
                        <span class="pattern-severity severity-${item.severity}">${item.severity.toUpperCase()}</span>
                    </div>`;
                });
                html += '</div>';
            }
            
            container.innerHTML = html || '<p style="text-align: center; color: #4caf50;">✅ No suspicious patterns detected</p>';
            
            // Update badge
            if (totalIssues > 0) {
                const badge = document.getElementById('suspiciousBadge');
                badge.textContent = totalIssues;
                badge.style.display = 'inline-block';
            }
        }

        function displayWritingQuality() {
            const qualityGrid = document.getElementById('qualityGrid');
            
            function getQualityClass(value, thresholds) {
                if (value <= thresholds[0]) return 'quality-good';
                if (value <= thresholds[1]) return 'quality-warning';
                return 'quality-poor';
            }
            
            qualityGrid.innerHTML = `
                <div class="quality-metric">
                    <h5>Passive Voice</h5>
                    <div class="quality-score ${getQualityClass(currentResults.passiveVoicePercentage, [20, 40])}">${currentResults.passiveVoicePercentage}%</div>
                    <div class="quality-hint">Target: <20%</div>
                </div>
                <div class="quality-metric">
                    <h5>Sentence Variety</h5>
                    <div class="quality-score ${getQualityClass(100 - currentResults.sentenceVariety, [30, 50])}">${currentResults.sentenceVariety}%</div>
                    <div class="quality-hint">Higher is better</div>
                </div>
                <div class="quality-metric">
                    <h5>Transition Words</h5>
                    <div class="quality-score ${getQualityClass(100 - currentResults.transitionWords, [85, 95])}">${currentResults.transitionWords}%</div>
                    <div class="quality-hint">Target: 10-15%</div>
                </div>
                <div class="quality-metric">
                    <h5>Hedging Language</h5>
                    <div class="quality-score ${getQualityClass(currentResults.hedgingLanguage, [5, 15])}">${currentResults.hedgingLanguage}%</div>
                    <div class="quality-hint">Balance needed</div>
                </div>
                <div class="quality-metric">
                    <h5>Academic Tone</h5>
                    <div class="quality-score ${getQualityClass(100 - currentResults.academicTone, [20, 40])}">${currentResults.academicTone}%</div>
                    <div class="quality-hint">Higher for formal</div>
                </div>
            `;
        }

        function displayComparison() {
            const comparisonGrid = document.getElementById('comparisonGrid');
            const similarityWarning = document.getElementById('similarityWarning');
            
            let html = '';
            currentResults.comparison.forEach(doc => {
                html += `
                    <div class="comparison-card">
                        <h4>${doc.name}</h4>
                        <div class="comparison-metrics">
                            <div class="metric-row">
                                <span class="metric-label">Word Count</span>
                                <span class="metric-value">${doc.wordCount.toLocaleString()}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Readability Score</span>
                                <span class="metric-value">${doc.readability.toFixed(1)}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">References</span>
                                <span class="metric-value">${doc.references}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Issues Found</span>
                                <span class="metric-value" style="color: ${doc.issues > 5 ? '#ff4444' : '#ffaa00'}">${doc.issues}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            comparisonGrid.innerHTML = html;
            
            // Mock similarity check
            if (uploadedFiles.length > 1) {
                similarityWarning.style.display = 'block';
                similarityWarning.innerHTML = `
                    <h4>⚠️ Similarity Alert</h4>
                    <p>Documents show 23% text similarity. This is within acceptable range for independent work.</p>
                    <p>High similarity sections: Introduction (45%), Methodology (38%)</p>
                `;
            }
        }

        // Export functions
        function exportMarkdown() {
            if (!currentResults) return;
            
            let markdown = `# CiteSight Analysis Report\n\n`;
            markdown += `**Processing Mode:** ${processingMode === 'local' ? 'Local (Privacy Mode)' : 'Server'}\n`;
            markdown += `**Generated by:** CiteSight Academic Document Analyzer\n\n`;
            
            markdown += `## Summary\n\n`;
            markdown += `- Total References: ${currentResults.totalReferences}\n`;
            markdown += `- Broken URLs: ${currentResults.brokenUrls}\n`;
            markdown += `- Unresolved DOIs: ${currentResults.unresolvedDois}\n`;
            markdown += `- Missing In-Text Citations: ${currentResults.missingInText}\n`;
            markdown += `- Orphaned In-Text Citations: ${currentResults.orphanedInText}\n\n`;
            
            markdown += `## Document Analysis\n\n`;
            markdown += `- Word Count: ${currentResults.wordCount}\n`;
            markdown += `- Readability Score: ${currentResults.fleschScore.toFixed(1)}\n`;
            markdown += `- Grade Level: ${currentResults.fleschKincaidGrade.toFixed(1)}\n\n`;
            
            markdown += `## Writing Quality\n\n`;
            markdown += `- Passive Voice: ${currentResults.passiveVoicePercentage}%\n`;
            markdown += `- Sentence Variety: ${currentResults.sentenceVariety}%\n`;
            markdown += `- Academic Tone: ${currentResults.academicTone}%\n\n`;
            
            markdown += `## Suspicious Patterns\n\n`;
            Object.entries(currentResults.suspiciousPatterns).forEach(([category, items]) => {
                if (items.length > 0) {
                    markdown += `### ${category.replace(/([A-Z])/g, ' $1').trim()}\n`;
                    items.forEach(item => {
                        markdown += `- [${item.severity.toUpperCase()}] ${item.text}\n`;
                    });
                    markdown += '\n';
                }
            });
            
            markdown += `## Issues\n\n`;
            currentResults.issues.forEach(issue => {
                markdown += `### ${issue.title}\n`;
                markdown += `${issue.details}\n\n`;
            });

            downloadFile('reference-report.md', markdown, 'text/markdown');
        }

        function exportText() {
            if (!currentResults) return;
            
            let text = `CITESIGHT ANALYSIS REPORT\n`;
            text += `${'='.repeat(30)}\n`;
            text += `Generated by: CiteSight Academic Document Analyzer\n`;
            text += `Processing Mode: ${processingMode === 'local' ? 'Local (Privacy Mode)' : 'Server'}\n\n`;
            
            text += `SUMMARY\n`;
            text += `${'-'.repeat(20)}\n`;
            text += `Total References: ${currentResults.totalReferences}\n`;
            text += `Broken URLs: ${currentResults.brokenUrls}\n`;
            text += `Unresolved DOIs: ${currentResults.unresolvedDois}\n`;
            text += `Missing In-Text Citations: ${currentResults.missingInText}\n`;
            text += `Orphaned In-Text Citations: ${currentResults.orphanedInText}\n\n`;
            
            text += `SUSPICIOUS PATTERNS\n`;
            text += `${'-'.repeat(20)}\n`;
            Object.entries(currentResults.suspiciousPatterns).forEach(([category, items]) => {
                if (items.length > 0) {
                    items.forEach(item => {
                        text += `[${item.severity.toUpperCase()}] ${item.text}\n`;
                    });
                }
            });
            text += '\n';
            
            text += `ISSUES\n`;
            text += `${'-'.repeat(20)}\n`;
            currentResults.issues.forEach(issue => {
                text += `\n${issue.title}\n`;
                text += `${issue.details}\n`;
            });

            downloadFile('reference-report.txt', text, 'text/plain');
        }

        function exportPDF() {
            alert('PDF export would require a backend service or library like jsPDF. For MVP, please use Markdown or Text export and convert to PDF using your preferred tool.');
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
        let uploadedFiles = [];
        let currentResults = null;

        // File upload handling
        const uploadSection = document.getElementById('uploadSection');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const optionsSection = document.getElementById('optionsSection');
        const processButton = document.getElementById('processButton');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressStatus = document.getElementById('progressStatus');
        const resultsSection = document.getElementById('resultsSection');

        uploadSection.addEventListener('click', () => fileInput.click());

        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            for (let file of files) {
                if (isValidFile(file)) {
                    uploadedFiles.push(file);
                }
            }
            updateFileList();
            if (uploadedFiles.length > 0) {
                optionsSection.style.display = 'block';
            }
        }

        function isValidFile(file) {
            const validExtensions = ['.pdf', '.docx', '.pptx', '.txt', '.md', '.json'];
            const fileName = file.name.toLowerCase();
            return validExtensions.some(ext => fileName.endsWith(ext));
        }

        function updateFileList() {
            fileList.innerHTML = '';
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div>
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="remove-file" onclick="removeFile(${index})">Remove</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateFileList();
            if (uploadedFiles.length === 0) {
                optionsSection.style.display = 'none';
            }
        }

        // Process documents
        processButton.addEventListener('click', async () => {
            if (uploadedFiles.length === 0) return;

            progressSection.style.display = 'block';
            resultsSection.style.display = 'none';
            processButton.disabled = true;

            // Simulate processing for demo
            await simulateProcessing();

            processButton.disabled = false;
        });

        async function simulateProcessing() {
            const steps = [
                { progress: 10, status: 'Extracting text from documents...' },
                { progress: 20, status: 'Analyzing document readability...' },
                { progress: 30, status: 'Identifying references...' },
                { progress: 40, status: 'Extracting URLs and DOIs...' },
                { progress: 50, status: 'Generating word analysis...' },
                { progress: 60, status: 'Checking URL accessibility...' },
                { progress: 70, status: 'Verifying DOIs...' },
                { progress: 80, status: 'Matching in-text citations...' },
                { progress: 90, status: 'Extracting unique phrases...' },
                { progress: 100, status: 'Generating report...' }
            ];

            for (let step of steps) {
                progressFill.style.width = step.progress + '%';
                progressFill.textContent = step.progress + '%';
                progressStatus.textContent = step.status;
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            // Show mock results
            showResults();
        }

        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
        }

        function calculateFleschScore(sentences, words, syllables) {
            // Flesch Reading Ease formula
            return 206.835 - 1.015 * (words / sentences) - 84.6 * (syllables / words);
        }

        function getReadabilityLevel(score) {
            if (score >= 60) return { level: 'Easy', class: 'readability-easy', description: 'Undergraduate level' };
            if (score >= 30) return { level: 'Medium', class: 'readability-medium', description: 'Graduate level' };
            return { level: 'Difficult', class: 'readability-hard', description: 'Professional/Academic' };
        }

        function showResults() {
            progressSection.style.display = 'none';
            resultsSection.style.display = 'block';

            // Mock results data with document analysis
            currentResults = {
                // Reference verification
                totalReferences: 45,
                brokenUrls: 3,
                unresolvedDois: 2,
                missingInText: 4,
                orphanedInText: 1,
                
                // Document analysis
                wordCount: 8547,
                sentenceCount: 342,
                avgWordsPerSentence: 25,
                paragraphCount: 87,
                fleschScore: 42.3,
                fleschKincaidGrade: 14.2,
                
                // Word analysis
                mostFrequentWords: [
                    { word: 'analysis', count: 89, size: 32 },
                    { word: 'methodology', count: 76, size: 30 },
                    { word: 'research', count: 72, size: 29 },
                    { word: 'significant', count: 64, size: 28 },
                    { word: 'hypothesis', count: 58, size: 26 },
                    { word: 'correlation', count: 52, size: 24 },
                    { word: 'framework', count: 48, size: 23 },
                    { word: 'empirical', count: 45, size: 22 },
                    { word: 'quantitative', count: 41, size: 21 },
                    { word: 'variables', count: 38, size: 20 },
                    { word: 'theoretical', count: 35, size: 19 },
                    { word: 'implementation', count: 32, size: 18 }
                ],
                
                uniqueWords: [
                    'paradigmatic', 'heteroscedasticity', 'epistemological', 'phenomenological',
                    'hermeneutic', 'axiological', 'ontological', 'triangulation',
                    'verisimilitude', 'praxis', 'dialectical', 'heuristic'
                ],
                
                uniquePhrases: [
                    { phrase: 'statistically significant correlation', count: 8 },
                    { phrase: 'theoretical framework suggests', count: 6 },
                    { phrase: 'empirical evidence indicates', count: 5 },
                    { phrase: 'methodological rigor ensures', count: 4 },
                    { phrase: 'null hypothesis rejected', count: 4 },
                    { phrase: 'convergent validity established', count: 3 },
                    { phrase: 'phenomenological inquiry reveals', count: 2 },
                    { phrase: 'epistemological stance adopted', count: 2 }
                ],
                
                issues: [
                    {
                        type: 'error',
                        title: 'Broken URL',
                        details: 'Reference #12: Smith, J. (2023). URL https://example.com/paper returns 404. Wayback Machine has a snapshot from 2023-01-15.'
                    },
                    {
                        type: 'error',
                        title: 'Unresolved DOI',
                        details: 'Reference #18: DOI 10.1234/invalid-doi could not be resolved.'
                    },
                    {
                        type: 'warning',
                        title: 'Missing in-text citation',
                        details: 'Reference #23: Johnson, K. (2022) appears in references but has no corresponding in-text citation.'
                    },
                    {
                        type: 'warning',
                        title: 'Orphaned in-text citation',
                        details: 'In-text citation (Williams, 2021) on page 7 has no corresponding reference entry.'
                    },
                    {
                        type: 'warning',
                        title: 'Inconsistent citation style',
                        details: 'Mixed use of "et al." and "and colleagues" detected. Reference #8 uses different format.'
                    }
                ]
            };

            // Display reference stats
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${currentResults.totalReferences}</div>
                    <div class="stat-label">Total References</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #ff4444">${currentResults.brokenUrls}</div>
                    <div class="stat-label">Broken URLs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #ff4444">${currentResults.unresolvedDois}</div>
                    <div class="stat-label">Unresolved DOIs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: #ffaa00">${currentResults.missingInText}</div>
                    <div class="stat-label">Missing In-Text</div>
                </div>
            `;

            // Display issues
            const issuesList = document.getElementById('issuesList');
            issuesList.innerHTML = '<h3>Issues Found:</h3>';
            currentResults.issues.forEach(issue => {
                const issueItem = document.createElement('div');
                issueItem.className = `issue-item ${issue.type === 'warning' ? 'warning' : ''}`;
                issueItem.innerHTML = `
                    <div class="issue-type">${issue.title}</div>
                    <div class="issue-details">${issue.details}</div>
                `;
                issuesList.appendChild(issueItem);
            });

            // Display document analysis
            const readability = getReadabilityLevel(currentResults.fleschScore);
            const analysisGrid = document.getElementById('analysisGrid');
            analysisGrid.innerHTML = `
                <div class="analysis-card">
                    <h4>Word Count</h4>
                    <div class="analysis-value">${currentResults.wordCount.toLocaleString()}</div>
                    <div class="analysis-label">Total words in document</div>
                </div>
                <div class="analysis-card">
                    <h4>Sentence Count</h4>
                    <div class="analysis-value">${currentResults.sentenceCount}</div>
                    <div class="analysis-label">Avg ${currentResults.avgWordsPerSentence} words/sentence</div>
                </div>
                <div class="analysis-card">
                    <h4>Flesch Reading Ease</h4>
                    <div class="analysis-value">${currentResults.fleschScore.toFixed(1)}</div>
                    <div class="readability-indicator ${readability.class}">${readability.level}: ${readability.description}</div>
                </div>
                <div class="analysis-card">
                    <h4>Flesch-Kincaid Grade</h4>
                    <div class="analysis-value">${currentResults.fleschKincaidGrade.toFixed(1)}</div>
                    <div class="analysis-label">Years of education needed</div>
                </div>
                <div class="analysis-card">
                    <h4>Paragraph Count</h4>
                    <div class="analysis-value">${currentResults.paragraphCount}</div>
                    <div class="analysis-label">Document structure</div>
                </div>
                <div class="analysis-card">
                    <h4>Unique Vocabulary</h4>
                    <div class="analysis-value">2,341</div>
                    <div class="analysis-label">Distinct words used</div>
                </div>
            `;

            // Display word cloud
            const wordCloud = document.getElementById('wordCloud');
            wordCloud.innerHTML = '';
            currentResults.mostFrequentWords.forEach(item => {
                const wordItem = document.createElement('span');
                wordItem.className = 'word-cloud-item';
                wordItem.style.fontSize = `${item.size}px`;
                wordItem.style.opacity = 0.6 + (item.size / 32) * 0.4;
                wordItem.innerHTML = `${item.word} <small>(${item.count})</small>`;
                wordCloud.appendChild(wordItem);
            });

            // Display unique/rare words
            const uniqueWords = document.getElementById('uniqueWords');
            uniqueWords.innerHTML = '';
            currentResults.uniqueWords.forEach(word => {
                const wordItem = document.createElement('span');
                wordItem.className = 'word-cloud-item';
                wordItem.style.fontSize = '14px';
                wordItem.style.background = 'linear-gradient(135deg, #ff6b6b20 0%, #feca5720 100%)';
                wordItem.innerHTML = word;
                uniqueWords.appendChild(wordItem);
            });

            // Display unique phrases
            const uniquePhrases = document.getElementById('uniquePhrases');
            uniquePhrases.innerHTML = '';
            currentResults.uniquePhrases.forEach(item => {
                const phraseItem = document.createElement('div');
                phraseItem.className = 'phrase-item';
                phraseItem.innerHTML = `
                    <span class="phrase-text">"${item.phrase}"</span>
                    <span class="phrase-count">${item.count}x</span>
                `;
                uniquePhrases.appendChild(phraseItem);
            });
        }

        // Export functions
        function exportMarkdown() {
            if (!currentResults) return;
            
            let markdown = `# Reference Verification Report\n\n`;
            markdown += `## Summary\n\n`;
            markdown += `- Total References: ${currentResults.totalReferences}\n`;
            markdown += `- Broken URLs: ${currentResults.brokenUrls}\n`;
            markdown += `- Unresolved DOIs: ${currentResults.unresolvedDois}\n`;
            markdown += `- Missing In-Text Citations: ${currentResults.missingInText}\n`;
            markdown += `- Orphaned In-Text Citations: ${currentResults.orphanedInText}\n\n`;
            markdown += `## Issues\n\n`;
            
            currentResults.issues.forEach(issue => {
                markdown += `### ${issue.title}\n`;
                markdown += `${issue.details}\n\n`;
            });

            downloadFile('reference-report.md', markdown, 'text/markdown');
        }

        function exportText() {
            if (!currentResults) return;
            
            let text = `REFERENCE VERIFICATION REPORT\n`;
            text += `${'='.repeat(30)}\n\n`;
            text += `SUMMARY\n`;
            text += `${'-'.repeat(20)}\n`;
            text += `Total References: ${currentResults.totalReferences}\n`;
            text += `Broken URLs: ${currentResults.brokenUrls}\n`;
            text += `Unresolved DOIs: ${currentResults.unresolvedDois}\n`;
            text += `Missing In-Text Citations: ${currentResults.missingInText}\n`;
            text += `Orphaned In-Text Citations: ${currentResults.orphanedInText}\n\n`;
            text += `ISSUES\n`;
            text += `${'-'.repeat(20)}\n`;
            
            currentResults.issues.forEach(issue => {
                text += `\n${issue.title}\n`;
                text += `${issue.details}\n`;
            });

            downloadFile('reference-report.txt', text, 'text/plain');
        }

        function exportPDF() {
            alert('PDF export would require a backend service or library like jsPDF. For MVP, please use Markdown or Text export and convert to PDF using your preferred tool.');
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>